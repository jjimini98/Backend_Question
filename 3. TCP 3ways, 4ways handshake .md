## 3 Ways handshake , 4 Ways handshake 

### 1. 3 Ways handshake 
- TCP/IP 프로토콜을 이용해 통신하는 응용프로그램이 데이터를 전송하기 전에 정확한 전송ㅇ을 보장하기 위해 서버와 사전에 세션을 수립하는 과정이다.

수행과정
1. 클라이언트가 open() 을 수행한 후 SVN을 서버에게 전송 
2. SVN을 받은 서버는 SVN_recv() 수행
3. 서버는 SVN과 응답인 ACK를 클라이언트에게 보냄
4. SVN과 ACK를 받은 클라이언트는 ESTABLISHED 상태로 전환
5. 클라이언트는 응답인 ACK를 다시 서버에게 보냄 
6. 서버는 ACK를 받고 ESTABLISHED 상태로 변경한다


### 2. 4 Ways handshake 
- 세션을 종료하기 위해 수행되는 절차를 말한다.


수행과정
1. 클라이언트가 close() 명령어를 실행한 후 FIN을 서버로 보내고 FIN_WAIT1 상태로 대기한다.
2. FIN을 받은 서버는 close_wait 로 상태를 바꾸고 ACK를 클라이언트로 보낸다. 이때 서버는 해당포트에 연결되어있던 서버 애플리케이션에게 close()를 요청한다.
3. ACK를 받은 클라이언트는 FIN_WAIT2 로 상태를 변경한다. 
4. close() 요청을 받은 서버 애플리케이션은 종료 프로세스를 진행한다. 서버는 FIN을 클라이언트에게 보내고 LAST_ACK로 상태를 변경한다.
5. 클라이언트는 FIN을 받고 ACK를 서버로 다시 전송하고 TIME_WAIT로 상태를 변경한다.
6. 그리고 일정 시간이 흐르면 CLOSED 된다. 
7. ACK를 받은 서버도 일정 시간이 흐르면 서버의 포트도 CLOSED 된다.

*서버만 CLOSE_WAIT 상태를 갖는 것은 아님. 서버가 먼저 종료하겠다고 close() 명령어를 보낼수도 있음 즉, 누가 먼저 close를 요청하냐에 따라 프로세스가 조금 달라질 수 있음 

<깃허브의 답안>

TCP가 가상회선을 만들고 제거하는 과정에 대해서 묻는 질문입니다. TCP를 공부하셨다면 이 정도는 알겠지 하고 묻는 문제고, 실제 면접자리에서는 보통 네트워크에 대해서 설명할 때, 직접 설명하는 편입니다.

TCP 3way handshake는 가상회선을 수립하는 단계입니다. 클라이언트는 서버에 요청을 전송할 수 있는지, 서버는 클라이언트에게 응답을 전송할 수 있는지 확인하는 과정입니다. SYN, ACK 패킷을 주고받으며, 임의의 난수로 SYN 플래그를 전송하고, ACK 플래그에는 1을 더한값을 전송합니다. 정확한 순서는 SYN(n) -> ACK(n + 1), SYN(m) -> ACK(m + 1) 순으로 일어납니다.

왜 임의의 난수를 지정하느냐는 꼬리질문이 나올 수 있습니다. 기존 요청과 구분하기 위해서 정도로 알고있고, 그 이상은 생각해본적이 없네요.


TCP 4way handshake는 TCP연결을 해제하는 단계로, 클라이언트는 서버에게 연결해제를 통지하고 서버가 이를 확인하고 클라이언트에게 이를 받았음을 전송해주고 최종적으로 연결이 해제됩니다. 단, 서버에서 소켓이 닫혔다고 통지해도 클라이언트 측에서는 일정시간 대기하는데, 혹시나 패킷이 나중에 도착할 수 있기 때문입니다.
